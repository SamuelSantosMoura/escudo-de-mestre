<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="Aparencia.css">
  <title>Iniciativa de RPG</title>
  <link rel="shortcut icon" href="Image/Logo/favicon.ico" type="image/x-icon">
  <style>
    :root {
      --bg: #0f172a;        /* slate-900 */
      --panel: #111827;     /* gray-900 */
      --muted: #94a3b8;     /* slate-400 */
      --text: #e5e7eb;      /* gray-200 */
      --accent: #22d3ee;    /* cyan-400 */
      --accent-2: #38bdf8;  /* sky-400 */
      --danger: #ef4444;    /* red-500 */
      --ok: #4ade80;        /* green-400 */
      --shadow: 0 10px 25px rgba(0,0,0,.35);
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: radial-gradient(1200px 800px at 20% -20%, rgba(34,211,238,.15), transparent 40%),
                  radial-gradient(1000px 700px at 120% 120%, rgba(56,189,248,.12), transparent 40%),
                  var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      min-height: 100vh;
      display: grid;
      place-items: start center;
      padding: 32px 16px 48px;
    }
    .wrap { width: 100%; max-width: 920px; }

    header {
      display: flex; align-items: center; justify-content: space-between;
      gap: 12px; margin-bottom: 18px;
    }
    .title {
      font-weight: 800; font-size: clamp(22px, 2.4vw, 32px);
      letter-spacing: .3px;
      display: flex; align-items: center; gap: 10px;
    }
    .title .dot { width: 12px; height: 12px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), var(--accent-2)); box-shadow: 0 0 0 3px rgba(34,211,238,.15); }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border: 1px solid rgba(148,163,184,.2);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .controls { padding: 16px; display: grid; grid-template-columns: 1.2fr .6fr auto auto; gap: 12px; }
    .controls input[type="text"], .controls input[type="number"] {
      width: 100%; padding: 12px 14px; border-radius: 12px; outline: none; border: 1px solid rgba(148,163,184,.25);
      background: #0b1220; color: var(--text);
    }
    .controls input::placeholder { color: var(--muted); }
    .btn {
      padding: 12px 14px; border-radius: 12px; border: 1px solid rgba(148,163,184,.25);
      background: #0b1220; color: var(--text); cursor: pointer; transition: transform .04s ease, border-color .2s;
      display: inline-flex; align-items: center; gap: 8px; font-weight: 600;
    }
    .btn:hover { border-color: var(--accent); }
    .btn:active { transform: translateY(1px); }
    .btn.primary { background: linear-gradient(135deg, rgba(34,211,238,.15), rgba(56,189,248,.15)); border-color: rgba(34,211,238,.45); }
    .btn.danger { border-color: rgba(239,68,68,.45); }

    .table-wrap { margin-top: 14px; }
    table { width: 100%; border-collapse: collapse; }
    thead th {
      text-align: left; font-size: 12px; text-transform: uppercase; letter-spacing: .12em; color: var(--muted);
      padding: 12px 14px; border-bottom: 1px solid rgba(148,163,184,.18);
    }
    tbody td { padding: 12px 14px; border-bottom: 1px solid rgba(148,163,184,.12); }
    tbody tr:hover { background: rgba(148,163,184,.06); }

    .num { font-variant-numeric: tabular-nums; text-align: right; }
    .actions { display: flex; gap: 8px; justify-content: flex-end; }
    .chip { padding: 6px 10px; border-radius: 999px; font-weight: 700; background: rgba(34,211,238,.14); border: 1px solid rgba(34,211,238,.32); }
    .hint { color: var(--muted); font-size: 13px; margin-top: 10px; padding: 0 4px 4px; }

    @media (max-width: 640px) {
      .controls { grid-template-columns: 1fr 1fr; }
      .controls .btn { grid-column: span 1; }
      .controls .btn.reset { grid-column: span 2; }
      .num { text-align: left; }
    }
  </style>
</head>
<body><div class="wrap">
    <header>
      <div class="title"><span class="dot"></span> Iniciativa de RPG</div>
      <button id="resetBtn" class="btn danger reset" title="Apagar tudo">üóëÔ∏è Limpar</button>
      <div class="buttons mb-6 text-center space-x-4">
            <a class="button-link" href="index.html">Gerar NPC</a>
            <a class="button-link" href="Escudo.html">Escudo de Mestre</a>
            <a class="button-link" href="Monstros.html">Monstros</a>
            <a class="button-link" href="eventos.html">Eventos Aleat√≥rios</a>
        </div>
    </header>

    <section class="card">
      <div class="controls">
        <input id="nameInput" type="text" placeholder="Nome do personagem / criatura" autocomplete="off" />
        <input id="initInput" type="number" inputmode="numeric" step="1" placeholder="Iniciativa (n√∫mero)" />
        <button id="addBtn" class="btn primary" title="Adicionar entrada">‚ûï Adicionar</button>
        <button id="rollBtn" class="btn" title="Rolar d20 e somar ao modificador digitado">üé≤ d20 + mod</button>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Nome</th>
              <th class="num">Iniciativa</th>
              <th class="num">A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="listBody"></tbody>
        </table>
        <div class="hint">Dica: a lista √© ordenada automaticamente em <b>ordem decrescente</b> (maior para menor) pelo n√∫mero de iniciativa.</div>
      </div>
    </section>
  </div>

  <template id="rowTemplate">
    <tr>
      <td class="name"></td>
      <td class="num initiative"></td>
      <td class="num actions">
        <button class="btn edit" title="Editar">‚úèÔ∏è</button>
        <button class="btn danger remove" title="Remover">üóëÔ∏è</button>
      </td>
    </tr>
  </template>

  <dialog id="editDialog">
    <form method="dialog" id="editForm" style="min-width: 320px; background: var(--panel); color: var(--text); border: 1px solid rgba(148,163,184,.3); border-radius: 12px; padding: 16px; box-shadow: var(--shadow)">
      <h3 style="margin: 0 0 10px;">Editar entrada</h3>
      <label style="display:block; font-size:12px; color: var(--muted);">Nome</label>
      <input id="editName" type="text" style="width:100%; margin:6px 0 10px; padding:10px; border-radius:10px; border:1px solid rgba(148,163,184,.3); background:#0b1220; color:var(--text)">
      <label style="display:block; font-size:12px; color: var(--muted);">Iniciativa (n√∫mero)</label>
      <input id="editInit" type="number" step="1" style="width:100%; margin:6px 0 16px; padding:10px; border-radius:10px; border:1px solid rgba(148,163,184,.3); background:#0b1220; color:var(--text)">
      <div style="display:flex; gap:8px; justify-content:flex-end;">
        <button class="btn" value="cancel">Cancelar</button>
        <button class="btn primary" value="ok">Salvar</button>
      </div>
    </form>
  </dialog>

  <script>
    const nameInput = document.getElementById('nameInput');
    const initInput = document.getElementById('initInput');
    const addBtn = document.getElementById('addBtn');
    const rollBtn = document.getElementById('rollBtn');
    const resetBtn = document.getElementById('resetBtn');
    const listBody = document.getElementById('listBody');
    const rowTemplate = document.getElementById('rowTemplate');

    const editDialog = document.getElementById('editDialog');
    const editName = document.getElementById('editName');
    const editInit = document.getElementById('editInit');

    /** Estado **/
    let items = load() || [];

    function save() {
      try { localStorage.setItem('initiative-items', JSON.stringify(items)); } catch {}
    }
    function load() {
      try { return JSON.parse(localStorage.getItem('initiative-items')) || []; } catch { return []; }
    }

    function toNumber(value) {
      if (value === '' || value === null || value === undefined) return NaN;
      const n = Number(value);
      return Number.isFinite(n) ? n : NaN;
    }

    function sortItems() {
      // MUDAN√áA AQUI: b.init - a.init faz a ordem ser decrescente (maior fica em cima)
      items.sort((a, b) => b.init - a.init); 
    }

    function clearInputs() {
      nameInput.value = '';
      initInput.value = '';
      nameInput.focus();
    }

    function render() {
      listBody.innerHTML = '';
      sortItems();
      for (const item of items) {
        const row = rowTemplate.content.firstElementChild.cloneNode(true);
        row.querySelector('.name').textContent = item.name;
        row.querySelector('.initiative').innerHTML = `<span class="chip">${item.init}</span>`;

        row.querySelector('.edit').addEventListener('click', () => openEdit(item));
        row.querySelector('.remove').addEventListener('click', () => removeItem(item.id));
        listBody.appendChild(row);
      }
      save();
    }

    function addItem() {
      const name = (nameInput.value || '').trim();
      const init = toNumber(initInput.value);

      if (!name) {
        alert('Digite um nome.');
        nameInput.focus();
        return;
      }
      if (!Number.isFinite(init)) {
        alert('Iniciativa inv√°lida: use apenas n√∫meros (ex.: 12).');
        initInput.focus();
        return;
      }

      items.push({ id: crypto.randomUUID(), name, init });
      render();
      clearInputs();
    }

    function removeItem(id) {
      items = items.filter(i => i.id !== id);
      render();
    }

    function openEdit(item) {
      editName.value = item.name;
      editInit.value = item.init;
      editDialog.returnValue = 'cancel';
      editDialog.showModal();

      editDialog.onclose = () => {
        if (editDialog.returnValue !== 'ok') return;
        const name = editName.value.trim();
        const init = toNumber(editInit.value);
        if (!name) return alert('Nome n√£o pode ficar vazio.');
        if (!Number.isFinite(init)) return alert('Iniciativa inv√°lida.');
        const idx = items.findIndex(x => x.id === item.id);
        if (idx !== -1) {
          items[idx] = { ...items[idx], name, init };
          render();
        }
      };
    }

    function rollD20PlusMod() {
      const mod = toNumber(initInput.value);
      if (!Number.isFinite(mod)) {
        alert('Digite seu modificador num√©rico no campo de iniciativa para usar d20 + mod.');
        initInput.focus();
        return;
      }
      const d20 = Math.floor(Math.random() * 20) + 1;
      const total = d20 + mod;
      initInput.value = total;
      initInput.dispatchEvent(new Event('change'));
      // Um pequeno feedback
      addBtn.animate([{ transform: 'scale(1)' }, { transform: 'scale(1.06)' }, { transform: 'scale(1)' }], { duration: 200 });
    }

    // Eventos
    addBtn.addEventListener('click', addItem);
    rollBtn.addEventListener('click', rollD20PlusMod);
    resetBtn.addEventListener('click', () => {
      if (confirm('Tem certeza que deseja limpar toda a lista?')) {
        items = [];
        render();
        clearInputs();
      }
    });

    // Enter para adicionar
    [nameInput, initInput].forEach(el => el.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') addItem();
    }));

    // Reordena quando o n√∫mero mudar manualmente (se editarmos via di√°logo j√° re-renderiza)
    initInput.addEventListener('change', () => {
      const n = toNumber(initInput.value);
      if (!Number.isFinite(n)) initInput.value = '';
    });

    // Inicializa
    render();
  </script>
</body>
</html>
